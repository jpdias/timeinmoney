package com.toostronk.timeinmoney;

import java.io.File;
import java.io.FileOutputStream;
import java.io.ObjectOutputStream;
import java.util.ArrayList;
import java.util.Calendar;

import android.os.Bundle;
import android.app.ActionBar;
import android.app.Activity;
import android.app.AlertDialog;
import android.content.DialogInterface;
import android.content.DialogInterface.OnClickListener;
import android.content.Intent;
import android.util.Log;
import android.view.Menu;
import android.view.MenuItem;
import android.view.View;
import android.widget.Button;
import android.widget.DatePicker;
import android.widget.EditText;

import com.jeremyfeinstein.slidingmenu.lib.SlidingMenu;
import com.jeremyfeinstein.slidingmenu.lib.app.SlidingActivity;


public class NewEventActivity extends SlidingActivity {

	public Data data = new Data();
	

	@Override
	public void onCreate(Bundle savedInstanceState){
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_new);

		
	 setBehindContentView(R.layout.activity_menu);
        getSlidingMenu().setBehindOffset(200);
        
        //Enable top button
        ActionBar actionBar = getActionBar();
    	actionBar.setDisplayHomeAsUpEnabled(true);
    	
    	final EditText name   = (EditText) findViewById(R.id.Name_Field);
    	final EditText type   = (EditText) findViewById(R.id.Type_Spinner);
    	final EditText cost  = (EditText) findViewById(R.id.Cost_field);
    	final EditText notes  = (EditText) findViewById(R.id.Notes_Field);
    	final DatePicker datePicker;
        datePicker = (DatePicker)  findViewById(R.id.Date_Picker);
        
        final Button Butmain = (Button)findViewById(R.id.home);

        Butmain.setOnClickListener(new View.OnClickListener() {
            public void onClick(View v) {
                Intent intent = new Intent(NewEventActivity.this,MainActivity.class); 
                finish();
                startActivity(intent);
            }
        });
        
		final Button Butadd = (Button)findViewById(R.id.Save_button);
		
		Butadd.setOnClickListener(new View.OnClickListener() {
            public void onClick(View v) {
                Intent intent = new Intent(NewEventActivity.this,NewEventActivity.class); 
                finish();
                startActivity(intent);
            }
        });
		
        final Button Butexit = (Button)findViewById(R.id.exit);

        Butexit.setOnClickListener(new View.OnClickListener() {
            public void onClick(View v) {
            	 new AlertDialog.Builder(NewEventActivity.this)
  	           .setMessage("Are you sure you want to exit?")
  	           .setCancelable(false)
  	           .setPositiveButton("Yes", new DialogInterface.OnClickListener() {
  	               public void onClick(DialogInterface dialog, int id) {
  	            	 finish();
  	                System.exit(0);
  	               }
  	           })
  	           .setNegativeButton("No", null)
  	           .show();
            }
        });
        
		 final Button Butcancel = (Button)findViewById(R.id.Cancel_button);
		
		Butcancel.setOnClickListener(new View.OnClickListener() {
            public void onClick(View v) {
            	 new AlertDialog.Builder(NewEventActivity.this)
  	           .setMessage("Are you sure you want to exit?")
  	           .setCancelable(false)
  	           .setPositiveButton("Yes", new DialogInterface.OnClickListener() {
  	               public void onClick(DialogInterface dialog, int id) {
  	            	 finish();
  	                System.exit(0);
  	               }
  	           })
  	           .setNegativeButton("No", null)
  	           .show();
            }
        });
		
		final Button Butsave = (Button)findViewById(R.id.Save_button);

        Butsave.setOnClickListener(new View.OnClickListener() {
            public void onClick(View v) {
            	
            	
            	data.data=String.valueOf(datePicker.getDayOfMonth())
                        + "/" + String.valueOf(datePicker.getMonth()) + "/"
                        + String.valueOf(datePicker.getYear());
            	data.notes=notes.toString();
            	data.cost=Double.parseDouble(cost.toString());
            	data.type=type.toString();
            	data.name=name.toString();
            	
            	
            	
            	
            	
                Intent intent = new Intent(NewEventActivity.this,MainActivity.class); 
                 startActivity(intent);
                 finish();
            }
        });
		
        final Button Butstat = (Button)findViewById(R.id.statistics);

        Butstat.setOnClickListener(new View.OnClickListener() {
            public void onClick(View v) {
                Intent intent = new Intent(NewEventActivity.this,StatisticsActivity.class); 
                 startActivity(intent);
                 finish();
            }
        });
        final Button Butstart = (Button)findViewById(R.id.about);

        Butstart.setOnClickListener(new View.OnClickListener() {
            public void onClick(View v) {
                Intent intent = new Intent(NewEventActivity.this,AboutActivity.class); 
                 startActivity(intent);
                 finish();
            }
        });
    }


	private void saveState() {
	    final File cache_dir = this.getCacheDir(); 
	    final File suspend_f = new File(cache_dir.getAbsoluteFile() + File.separator );

	    FileOutputStream   fos  = null;
	    ObjectOutputStream oos  = null;
	    boolean            keep = true;

	    try {
	        fos = new FileOutputStream(suspend_f);
	        oos = new ObjectOutputStream(fos);

	        oos.writeObject(this.data);
	    }
	    catch (Exception e) {
	        keep = false;
	        Log.e("MyAppName", "failed to suspend", e);
	    }
	    finally {
	        try {
	            if (oos != null)   oos.close();
	            if (fos != null)   fos.close();
	            if (keep == false) suspend_f.delete();
	        }
	        catch (Exception e) { /* do nothing */ }
	    }
	}
	
	
	
    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        // Inflate the menu; this adds items to the action bar if it is present.
        //getMenuInflater().inflate(R.menu.main, menu);
        return true;
    }
    
    @Override
	public void onBackPressed() {
	    new AlertDialog.Builder(this)
	           .setMessage("Are you sure you want to exit?")
	           .setCancelable(false)
	           .setPositiveButton("Yes", new DialogInterface.OnClickListener() {
	               public void onClick(DialogInterface dialog, int id) {
	            	   NewEventActivity.this.finish();
	               }
	           })
	           .setNegativeButton("No", null)
	           .show();
	}
    
	@Override
	public boolean onOptionsItemSelected(MenuItem item){
	    toggle();
	    return true;

	}
}

